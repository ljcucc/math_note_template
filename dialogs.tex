\usepackage{graphicx}     % 确保加载 graphicx 宏包
\usepackage{xeCJK}
\usepackage[dvipsnames]{xcolor}
\usepackage{framed}
\usepackage{ifthen}    % 載入 ifthen 套件

% ========== Character settings content ==========

\input{settings}

% ========== Configs ==========

\graphicspath{ {./assets/} }

\setCJKmainfont{LXGW WenKai TC}
\setmainfont{LXGW WenKai TC}

% \setCJKmainfont{jf-openhuninn-2.0}
% \setmainfont{jf-openhuninn-2.0}

\newcommand{\readerName}{歐亞狼. 沃夫}
\newcommand{\teacherName}{IT. 龍}
\colorlet{readerColor}{YellowOrange}
\definecolor{teacherColor}{RGB}{21, 66, 130}

% ========== Gaps ==========

% --- 定義條件式的 vspace 指令 ---
% 如果文章段落很長，可以使用這種 Gap 來避免小文件文字被覆蓋的問題。
\newcommand{\smallerVerticalGap}{%
  % \lengthtest{} 用於比較長度
  % 檢查 \paperwidth 是否小於 180mm (A5=148mm, A4=210mm)
  \ifthenelse{\lengthtest{\paperwidth < 180mm}}{%
    % --- 如果為 TRUE (偵測到類 A5 尺寸) ---
    \par\vspace{0cm}% 在 A5 時使用的間距
    %\typeout{Paper detected as A5-ish, using vspace 0cm}% 取消註解可看訊息
  }{%
    % --- 如果為 FALSE (偵測到類 A4 或更大尺寸) ---
    \par\vspace{-2cm}% 在 A4 時使用的間距
    %\typeout{Paper detected as non-A5, using vspace -2cm}% 取消註解可看訊息
  }%
  % 加 \par 確保 vspace 在垂直模式下生效
}
% --- 結束定義 ---


% ========== Image & Text Composition Block ==========

% 定义主宏命令 (保持不变)
\newcommand{\imageAndText}[4]{%
  \par\noindent
  \begin{minipage}[c]{#1}%
    #2% <--- 图片或图片内容放这里
  \end{minipage}%
  \hspace{#3}%
  \begin{minipage}[c]{\dimexpr0.5\linewidth-#3\relax}%
    \begin{flushleft}
      #4% <--- 文本放这里
    \end{flushleft}
  \end{minipage}%
  \par
}

\newcommand{\textAndImage}[4]{%
  \par\noindent
  \begin{flushright}
  \begin{minipage}[c]{\dimexpr0.5\linewidth-#3\relax}%
  \begin{flushright}
    #4% <--- 文本放这里
    \end{flushright}
  \end{minipage}%
  \hspace{#3}%
  \begin{minipage}[c]{#1}%
    #2% <--- 图片或图片内容放这里
  \end{minipage}%
  \end{flushright}
  \par
}

% ========== Positoin Block ==========

\newenvironment{textRight}[0]{%
  % Code executed at \begin{textRight}
  \par\noindent
  \begin{flushright}%
  \begin{minipage}[c]{\dimexpr0.75\textwidth\relax}%
}{%
  % Code executed at \end{textRight}
  \end{minipage}%
  \end{flushright}%
  \par%
}

\newenvironment{textLeft}[0]{%
  % Code executed at \begin{textRight}
  \par\noindent
  \begin{flushleft}%
  \begin{minipage}[c]{\dimexpr0.75\textwidth\relax}%
}{%
  % Code executed at \end{textRight}
  \end{minipage}%
  \end{flushleft}%
  \par%
}

% ========== Someone Said Paragraph Block ==========

\newenvironment{readerSaid}{
  \medskip
    \color{readerColor}
}{\medskip}

\newenvironment{teacherSaid}{
  \medskip
    \color{teacherColor}
}{\medskip}

% ========== Reader Dialog ==========

\newcommand{\readerDialog}[2]{
  \textAndImage
    {0.25\textwidth} % 左侧区域宽度
    {%
      % 这是 figure 环境里面的内容，但没有 figure 环境本身
      \centering % 确保图片在左侧区域居中
      \includegraphics[width=\linewidth]{#2} % 使用 \linewidth 让图片宽度充满左侧区域
      \vspace{0.5em} % 图片和标题之间留一点垂直空间
      \centering % 确保标题文本居中
      \small % 使用小字体作为标题
      {\textcolor{readerColor}\readerName}
      % 注意：这里没有 \caption{...}，这只是普通的文本
      % 也不能使用 \label{...} 来引用
    } % 左侧区域内容 (图片 + 手动标题)
    {1em} % 图片和文本之间的间距
    {\linewidth0.35\textwidth\textcolor{readerColor}{#1}}
}


\newcommand{\readerConfused}[1]{
  \readerDialog{#1}{a-confused.png}
}

\newcommand{\readerEureka}[1]{
  \readerDialog{#1}{a-eureka.png}
}

\newcommand{\readerQuestioning}[1]{
  \readerDialog{#1}{a-questioning.png}
}

\newcommand{\readerExcitement}[1]{
  \readerDialog{#1}{a-excitement.png}
}

\newcommand{\readerGrinning}[1]{
  \readerDialog{#1}{a-grinning.png}
}

\newcommand{\readerAgree}[1]{
  \readerDialog{#1}{a-agree.png}
}

\newcommand{\readerConcern}[1]{
  \readerDialog{#1}{a-concern.png}
}

% ========== Teacher Dialog ==========

\newcommand{\teacherDialog}[2]{
  \imageAndText
  {0.25\textwidth}
  {
    \centering
    \includegraphics[width=\linewidth]{#2}
    \vspace{0.5em}
    \centering
    \small
    {\textcolor{teacherColor}\teacherName}
  }
  {1em}
  {\textcolor{teacherColor}{#1}}
}

\newcommand{\teacherConfident}[1]{
  \teacherDialog{#1}{b-confident.png}
}

\newcommand{\teacherTalking}[1]{
  \teacherDialog{#1}{b-talking.png}
}

\newcommand{\teacherPause}[1]{
  \teacherDialog{#1}{b-pause.png}
}

\newcommand{\teacherAgree}[1]{
  \teacherDialog{#1}{b-agree.png}
}

\newcommand{\teacherAngry}[1]{
  \teacherDialog{#1}{b-angry.png}
}

\newcommand{\teacherNervous}[1]{
  \teacherDialog{#1}{b-nervous.png}
}

\newcommand{\teacherAfraid}[1]{
  \teacherDialog{#1}{b-afraid.png}
}
% ========== Plot color settings ==========

\newcommand{\teacherPlotSettings}{
  \pgfplotsset{
    axis line style={teacherColor},
    every axis label/.append style ={teacherColor},
    every tick label/.append style={teacherColor}
  }
}
